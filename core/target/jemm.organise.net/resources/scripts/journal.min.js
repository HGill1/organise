var setCounter=0;function init(){$("input:button").button();$("#submit").button();$(document).mousemove(function(a){checkSessionTimeOut()});$("#toggleAddForm").live("click",function(a){checkSessionTimeOut()});$("#topicSave").live("click",function(a){$("#subTopicsName").val(subtopicArray)});$("a:not(.selectBox, .selectBox-dropdown-menu a)").click(function(){$("#allSourcesList").one("click","a",function(){resetAllVariable();$(".new-item").removeAttr("style");$(".left-nav-dropdown").children("li").removeAttr("style");if(jQuery(this).attr("id")=="multiSourceFilterId"){$("#filterCatId").val(0);jQuery("[data-control=leftNavFolders] .green").removeClass("green");jQuery(this).closest("li").addClass("green");$("#multiSourceFilter").val(true);var c=$("#hiddenUserId").val();$("#editShowHideIcon").remove();jQuery("[data-control=editLeftNav]").append("<i id='editShowHideIcon' class='icon-edit-box'></i>");updateFeedSources(c);multiSourceFilterFeeds(c,0,false)}if(jQuery(this).attr("id").substr(0,6)=="source"){var a=jQuery(this).attr("id").substr(6);$("#filterCatId").val(a);$("#feedSourceId").selectBox("value",a+"-"+jQuery(this).data("topicColour"));jQuery(this).parent("li").attr("style","text-shadow:#fff 0px 1px 0, #000 0 -1px 0;BACKGROUND-COLOR: #CDDAED");$("#filterStatusId").val(0);$("#filterUserId").val(0);filterFeeds(a,0,0,false,0,false);clickedOnce=false}if(jQuery(this).attr("id").substr(0,8)=="subtopic"){var b=jQuery(this).attr("id").substr(8);deleteSubTopic(b)}});$("#allFollowingList").one("click","a",function(){resetAllVariable();if(jQuery(this).attr("id")=="followingCat"){var b=jQuery(this).children("input").attr("value");var a=$("#hiddenUserId").val();$("#followingByCat").val(true);$("#followCatId").val(b);followedTasksInCat(b,a,0,false)}});$("#recentlyViewedTh").one("click","a",function(){resetAllVariable();var a=jQuery(this).children("input").attr("value");var b=$("#hiddenUserId").val();recentlyViewedThread(b,a,0,false)});$("#onlineUsersContainer").on("click","a",function(){showUserTasks(jQuery(this))});$("#offlineUsersContainer").one("click","a",function(){showUserTasks(jQuery(this))})});$("#selectTasksType").selectBox().change(function(){$("#myAddedTasksClicked").val(false);$("#urgentClicked").val(false);$("#displayAllUsersTasks").val(false);resetAllVariable();selectedTaskType=$(this).val();selectedOrder=$("#orderBy").val();pageStart=1;loadingImage();if(selectedTaskType=="myTask"){tId=jQuery("#filterCatId").val();var a=$("#hiddenUserId").val();$("#displayAllUsersTasks").val(true);displayAllMyTasks(a,0,false,0,tId)}if(selectedTaskType=="myAddedTasks"){tId=jQuery("#filterCatId").val();var a=$("#hiddenUserId").val();$("#myAddedTasksClicked").val(true);$("#filterStatusId").val(0);$("#filterUserId").val(0);filterFeeds(tId,0,0,false,0,false,a,selectedOrder)}if(selectedTaskType==1){tId=jQuery("#filterCatId").val();$("#urgentClicked").val(true);$("#filterStatusId").val(0);$("#filterUserId").val(0);filterFeeds(tId,0,0,true,0,false,null,selectedOrder)}if(selectedTaskType==2){tId=jQuery("#filterCatId").val();$("#filterStatusId").val(2);$("#filterUserId").val(0);filterFeeds(tId,0,2,false,0,false,null,selectedOrder)}if(selectedTaskType==3){tId=jQuery("#filterCatId").val();$("#filterStatusId").val(3);$("#filterUserId").val(0);filterFeeds(tId,0,3,false,0,false,null,selectedOrder)}if(selectedTaskType==4){tId=jQuery("#filterCatId").val();$("#filterStatusId").val(4);$("#filterUserId").val(0);filterFeeds(tId,0,4,false,0,false,null,selectedOrder)}if(selectedTaskType==0){window.location="index"}});$("#orderBy").selectBox().change(function(){selectedOrder=$(this).val();selectedTaskType=$("#selectTasksType").val();pageStart=0;var a=0;var b=0;var c=selectedTaskType;var g=false;var f=false;var e=null;if(selectedTaskType=="myTask"){c=0;b=$("#hiddenUserId").val()}if(selectedTaskType=="myAddedTasks"){c=0;e=$("#hiddenUserId").val()}if(selectedTaskType==1){c=0;g=true}filterFeeds(a,b,c,g,pageStart,f,e,selectedOrder)});$("#sourceType").selectBox().change(function(){if($(this).val()>0){$("#divToken").removeClass("hide");$("#divUrl").removeClass("hide")}else{$("#divToken").addClass("hide");$("#divUrl").addClass("hide");$("#url").val("");$("#token").val("")}});$("#tasksViewType").selectBox().change(function(){var a=$("#hiddenUserId").val();var b=$("#tasksViewType").val();$("#listViewTypeSelected").val($("#tasksViewType").val());$.post("updateViewType",{viewType:b,userId:a},function(c){location.reload(true)})});$("a:not(.selectBox, .selectBox-dropdown-menu a)").click(function(){$("#orderBy").selectBox("value",0);$("#selectTasksType").selectBox("value",0)});jQuery.validator.addMethod("selectNone",function(a,b){if(b.value!="0"){return true}},"Please select a topic.");jQuery.validator.addMethod("validDate",function(a,b){currentdate=new Date();if(b.value==""||b.value>=currentdate.format("mm/dd/yyyy")){return true}else{return false}},"Date should be greater than current date.");jQuery.validator.addMethod("validAssignee",function(e,a){console.log(e.length);if(e.length>0){var c=$("span","#assigneeDetail").map(function(){return $(this).data("assigneeName")}).get();var b=$("span","#deptDetail").map(function(){return $(this).data("deptName")}).get();if(jQuery.inArray(e,$.merge($.merge([],c),b))>-1){return true}else{return false}}else{return true}},"Assignee name is invalid.");$("#addNotes").validate({rules:{feedSourceId:{selectNone:false},name:"required",summary:"required",assignEmailAndId:{validAssignee:true,},url:{url:true},deadline:{validDate:true}},messages:{name:"Please enter title name.",summary:"Please enter summary",url:{url:"Please enter valid url."}},submitHandler:function(j){if($("#feedSourceId").val()==0){$("#selectTopicError").remove();$("#topicSelectionArea").append("<div id='selectTopicError' style='color:red'>Please select a topic.</div>");return false}var a=$("#deadline").val();japp.campaign.cancelAddCampaign();var c=new Date(),h=$("#contentContainer"),g=0,f=$("body").data("filelist"),e=$("#feedSourceId").val().split("-"),i=$("#newTaskObject").data("taskdetail"),b=$("#assignEmailAndId");assignee=b.attr("data-selected-item-id");i.feedSourceId=e[0];i.name=$("#name").val();i.summary=$("#summary").val();i.deadline=a;i.assignToName=(b.val().length!=0)?b.val():"All";i.colour=e[1];i.createdAt=c;if($("#status").is(":checked")){i.urgentStatus=true}str=displayList(i,g,c,"active",f,f.length,i,"jquery");h.children(".campaign-line").removeClass("active");h.prepend(str);if(a==""){a=new Date(1970,1,1)}else{a=$("#deadline").val()}$.post("addTask",{feedSourceId:i.feedSourceId,name:i.name,summary:i.summary,assignEmailAndId:assignee,assignToName:i.assignToName,deadline:a,urgentStatus:$("#status").is(":checked"),fileIds:getFilelist()},function(k){});$("#selectTopicError").remove();clearForm()}});$("#selRoleId").live("change",function(){$.post("updateRole",{roleId:$(this).val(),userId:$(this).closest("#userRoleInfo").find("#userId").val()},function(a){})});$("#replySubmitButton").live("click",function(c){var i=$("#assignTask").val();if(i.length>0){var p=$("span","#reassigneeDetail").map(function(){return $(this).data("assigneeName")}).get();var k=$("span","#reassignDept").map(function(){return $(this).data("deptName")}).get();if(jQuery.inArray(i,$.merge($.merge([],p),k))>-1){}else{$("#reassignTaskBlock").append('<div class="float-right"> <label style="margin-right: 73px;color: #F70808;">Invalid Assigner Name!</label></div>');return false}}c.preventDefault();c.stopPropagation();hideShowBindReplyForm();japp.campaign.hideReply();var e=$("#parentId").val(),j=$("#comments"+e),q="",f=new Date(),l=$("body").data("filelist"),a=$("#userObject").data("userdetail"),n=a.userImage,m=$("#replySummary").val(),h=$("#replyStatus").data("replyStatus"),o=new Date(),b=$("#assignTask").attr("data-selected-item-id"),g=$("#assignTask").val();if(b!=""&&g!=""){m=m+"<br> Reassigned task to: <strong>"+g+"</strong>"}q+=displaySingleSubTask(a,o,f,m,h,n,l,l.length);if($("#replyUrgentStatus").is(":checked")){$("#title"+e).append('<div class="urgent"></div>')}if($("#replyStatus").val()==4){$("#taskContainer"+e).remove()}j.prepend(q);$.post("reply.htm",{feedSourceId:$("#sourceId").val(),name:$("#replyName").val(),summary:m,url:$("#replyUrl").val(),status:$("#replyStatus").val(),fileIds:getFilelist(),parentId:$("#parentId").val(),taskCreatorEmail:$("#taskAssignerEmail").val(),assignTo:$("#assignToId").val(),assignToDept:$("#assignToDept").val(),taskUpdateEmailNotify:$("#replyPostCommentEmailNotify").val(),assignToName:$("#replyAssignToName").val(),assignerName:$("#replyAssignerName").val(),assignToEmail:$("#taskAssignToEmail").val(),taskTitle:$("#replyTaskTitle").val(),statusUrgent:$("#replyUrgentStatus").is(":checked"),reassignerUser:b,reassigneeName:g,taskCreatorId:$("#taskAssignerId").val()},function(r){$.each(r,function(t,s){});clearReplyForm()})});$("#createUsers").validate({rules:{email:{required:true,email:true},firstName:"required",lastName:"required"},messages:{email:"Please enter email .",firstName:"Please enter first name",lastName:"Please enter last name"},submitHandler:function(a){$.post("checkUserExists.htm",{email:$(".emailcheck").val()},function(c){if(!c.email){a.submit()}else{var b='<label for="email" generated="true" class="error" style="">Email exists.</label>';$(".emailcheck").after(b)}})}});$("#feedSourceForm").validate({errorLabelContainer:"#messageBox",rules:{name:"required",checkedUserId:{required:true},url:{required:true,url:true},errorElement:"div",wrapper:"div",errorPlacement:function(b,a){offset=a.offset();b.insertBefore(a);b.addClass("message");b.css("position","absolute");b.css("left",offset.left+a.outerWidth());b.css("top",offset.top)}},messages:{name:"Please enter topic name .",checkedUserId:"Please select at least one user.",url:"Please enter URL for rss feed."}});$("input[id='searchBox']").change(function(){var a="%"+$("#searchBox").val()+"%";$("#multiSourceFilter").val(false);$("#searching").val(true);loadingImage();searchFeeds(a,0,false)});$("#cancelAdd").click(function(){clearForm()});$("#cancelUserForm").click(function(){clearUserForm($("#createUsers"))});$("#replyCancel").click(function(){clearReplyForm()});$("#upload").fileupload({dataType:"json",done:function(a,b){$.each(b.result,function(e,c){$("body").data("filelist").push(c);container=$("#attachmentsCont");formatFileDisplay(c,container)})}});$("#attach").live("click",function(){$("#upload").trigger("click")});$("#replyUpload").fileupload({dataType:"json",done:function(a,b){$.each(b.result,function(e,c){$("body").data("filelist").push(c);container=$("#replyAttachmentsCont");formatFileDisplay(c,container)})}});$("#replyAttach").live("click",function(){$("#replyUpload").trigger("click")});$("#profileImage").fileupload({dataType:"json",done:function(a,b){if(b.result!=null){$("#profilePhoto").attr("src",profileImage+b.result.split("/")[7])}else{alert("Image not uploaded! A valid image file is required.")}}});$("#uploadImage").live("click",function(){$("#profileImage").trigger("click")});$("#profileInnerImage").fileupload({dataType:"json",done:function(a,b){if(b.result!=null){$("#profileInnerPhoto").attr("src",profileImage+b.result.split("/")[7])}else{alert("Image not uploaded! A valid image file is required.")}}});$("#uploadProfileInnerImg").live("click",function(){$("#profileInnerImage").trigger("click")});$("#userInfo").validate({rules:{},messages:{},submitHandler:function(a){$.post("updateUserInfo",{id:$("#id").val(),firstName:$("#firstName").val(),lastName:$("#lastName").val(),jobTitle:$("#jobTitle").val(),email:$("#email").val(),regionId:$("#regionId").val()},function(b){if(b>0){location.reload(true)}})}});$("#userPass").validate({rules:{password:{required:true,minlength:6},confirmPassword:{required:true,equalTo:"#password",minlength:6},},messages:{},submitHandler:function(a){$.post("updateUserPassword.htm",{oldPassword:$("#oldPassword").val(),password:$("#password").val(),id:$("#id").val()},function(b){if(b==0){$("#oldpasserror").removeClass("hide").addClass("show").css("display","")}else{location.reload(true)}})}});$("#follow").live("click",function(b){var c=jQuery(this).children("input").attr("value");var a=$("#hiddenUserId").val();jQuery(this).attr("id","unfollow");jQuery(this).text("unfollow");$.post("followThread.htm",{followerId:a,id:c},function(e){if(e>0){reloadFollowing(a)}})});$("#unfollow").live("click",function(b){var c=jQuery(this).children("input").attr("value");var a=$("#hiddenUserId").val();jQuery(this).attr("id","follow");jQuery(this).text("follow");$.post("followThread.htm",{followerId:0,id:c},function(e){if(e>0){reloadFollowing(a)}})});$("#disableUser").live("click",function(a){var b=jQuery(this).children("input").attr("value");jQuery(this).attr("id","enableUser");jQuery(this).text("enable user");$.post("enableDisableUser",{userId:b,action:"disable"},function(c){})});$("#enableUser").live("click",function(a){var b=jQuery(this).children("input").attr("value");jQuery(this).attr("id","disableUser");jQuery(this).text("disable user");$.post("enableDisableUser",{userId:b,action:"enable"},function(c){})});$("#assignedTaskEmailTrue").change(function(){$.post("updateAssignedTaskEmail",{taskAddEmail:"True"})});$("#assignedTaskEmailFalse").change(function(){$.post("updateAssignedTaskEmail",{taskAddEmail:"False"})});$("#postCommentTrue").change(function(){$.post("updatePostCommentEmail",{taskUpdateEmail:"True"})});$("#postCommentFalse").change(function(){$.post("updatePostCommentEmail",{taskUpdateEmail:"False"})});$("body").data("filelist",new Array())}function modifyUserDept(a){console.log(a);console.log($("#"+a).serialize());$.ajax({type:"POST",url:"modifyUserDept",data:$("#"+a).serialize(),done:function(b){}})}function resetAllVariable(){$("#multiSourceFilter").val(false);$("#searching").val(false);$("#followingByCat").val(false);$("#pastDueTasks").val(false);$("#dueTodayTasks").val(false);$("#urgentTasks").val(false);$("#todayPendingTasks").val(false);$("#myAddedTasksClicked").val(false);$("#urgentClicked").val(false);$("#displayAllUsersTasks").val(false);$("#imgLoader").remove();pageStart=1;loadingImage()}function showUserTasks(a){resetAllVariable();if(a.attr("id").substr(0,6)=="myTask"){var b=a.attr("id").substr(6);$("#filterUserId").val(b);$("#filterStatusId").val(0);$("#filterCatId").val(0);filterFeeds(0,b,0,false,0,false)}}function loadingImage(){imageLoadCheck=1;$container=$("#contentContainer");$container.empty();$container.append('<div style="width: 10%; margin:auto;"><img src="resources/images/ajax-loader_c.gif" alt="loading..." title="loading..."  /></div>')}function commonChecksAndDisplay(b,a){$container=$("#contentContainer");if(!a){$container.empty()}currentDate=new Date();if(b.length>0){$.each(b,function(c,g){var f="";var e="";if(c==0){f="active"}e=displayList(g[0],g.length-1,currentDate,f,g[0].fileAttachment,g[0].attachmentCount,g,"java");$container.append(e);imageLoadCheck=0})}else{jQuery("#noRecords").remove();$container.append('<h1 id="noRecords" class="content-title">No records found!</h1>')}if(a){$("#imgLoader").remove();imageLoadCheck=0}japp.campaign.bindButtons()}function deleteFeed(a){$.post("deleteFeed",{id:a},function(b){if(b){checkUpdateStatus(true,false)}})}function deleteSource(a){$.post("deleteSource",{id:a},function(b){if(b){window.location="manageSources"}})}function deleteUser(a){$.post("deleteUser",{id:a},function(b){if(b){window.location="preferences?tabSelected=5"}})}function hideShowBindReplyForm(){japp.campaign.hideReply()}function searchFeeds(c,a,b){$.post("search",{searchText:c,pageStart:a},function(e){hideShowBindReplyForm();commonChecksAndDisplay(e,b)})}function updateFeedSources(b){var a=new Array();var c="";$.post("selectEnabledFeedSource.htm",{userId:b},function(e){$("li.new-item").remove();$.each(e,function(g,f){a[g]=f})});$.post("getAllSources.htm",{userId:b},function(e){$.each(e,function(j,k){var f="gray";var i="Hide";var h="";var g="";if(jQuery.inArray(k.id,a)>=0){f="";i="Show"}if(k.subTopics.length>0){h='data-control="dropdownExpander" class="left-nav-ddwn-item collapsed"';$.each(k.subTopics,function(m,l){g+="<li><i class='icon-ball'><i style='background:"+l.subtopicColor+";'></i></i> <a id=source"+l.subtopicId+" href='#'>"+l.subtopicName+"</a></li>"})}c+="<li class='new-item "+f+"'><i class='icon-ball'><i style='background:"+k.colour+"';></i></i><a "+h+" id=source"+k.id+" href='#'> "+k.name+" </a><input type='hidden' id='catIdForShowHide' value="+k.id+"><span class='edit-row' id='showHideId'><a href='#' data-control='editNavRow'>"+i+"</a></span><ul class='left-nav-dropdown accordion-hide'>"+g+"</ul></li>"});$("#allSourcesList").append(c)})}function reloadFollowing(a){strFollowCats="";$.post("reloadFollowing.htm",{followerId:a},function(b){$("li.new-follow").remove();$.each(b,function(e,c){strFollowCats+='<li class="new-follow"><i class="icon-ball"><i style="background: '+c.colour+';"></i></i><a id="followingCat" href="#">'+c.name+' <input type="hidden" id="followingCatId" value='+c.id+"></a></li>"});$("#allFollowingList").append(strFollowCats)})}function checkSessionTimeOut(){checkMouseOver=false;if(!checkMouseOver){checkMouseOver=true;$.post("checkUserLoggedin",function(a){if(a=="sessiontimeout"){alert("Your session has timed out.Please login again.");window.location.replace("login.htm")}})}}function formatFileDisplay(b,a){a.append('<span class="form-attached"><span>'+b.name+"("+(b.attachmentFileSize/1000).toFixed(2)+"K)</span> <i id="+b.id+' class="icon-del"></i></span> ')}$(".icon-del").live("click",function(a){var b=$(this).attr("id");$.post("deleteFile.htm",{fileId:b},function(f){if(f){var e=$("body").data("filelist");for(var c=0;c<e.length;c<c++){if(e[c].id==b){$("body").data("filelist").splice(c,1)}}$("#"+b).parent().remove()}})});function filterFeeds(f,c,e,i,b,h,g,a){$.post("filter.htm",{feedSourceId:f,assignTo:c,status:e,urgentStatus:i,userId:g,pageStart:b,orderBy:a},function(j){hideShowBindReplyForm();commonChecksAndDisplay(j,h)})}function multiSourceFilterFeeds(b,a,c){$.post("multiSourceFilterFeeds.htm",{userId:b,pageStart:a},function(e){hideShowBindReplyForm();commonChecksAndDisplay(e,c)})}function followedTasksInCat(b,e,a,c){$.post("threadsFollowedInCat.htm",{pageStart:a,followerId:e,feedSourceId:b},function(f){commonChecksAndDisplay(f,c)})}function displayOldTasksPending(b,a,c){$.post("displayOldTasksPending",{pageStart:a,userId:b},function(e){commonChecksAndDisplay(e,c)})}function displayTodaysDueTasks(b,a,c){$.post("displayTodaysDueTasks",{pageStart:a,userId:b},function(e){commonChecksAndDisplay(e,c)})}function displayUrgentTasks(b,a,c){$.post("displayUrgentTasks",{pageStart:a,userId:b},function(e){commonChecksAndDisplay(e,c)})}function displayTodaysTasksPending(b,a,c){$.post("displayTodaysTasksPending",{pageStart:a,userId:b},function(e){commonChecksAndDisplay(e,c)})}function displayAllMyTasks(e,c,f,a,b){$.post("displayAllMyTasks",{pageStart:c,userId:e,orderBy:a,feedSourceId:b},function(g){commonChecksAndDisplay(g,f)})}function recentlyViewedThread(b,a,c){$.post("threadRecentlyViewed.htm",{viewerId:b,id:a},function(e){commonChecksAndDisplay(e,c)})}function deleteSubTopic(a){$.post("deleteSubtopic",{id:a},function(b){})}function selectlastViewedThreads(a){strLastViewed="";$.post("selectlastViewed.htm",{userId:a},function(b){$("li.recently-viewed").remove();$.each(b,function(e,c){strLastViewed+='<li class="recently-viewed"><a id="recentlyViewedId" href="#">'+c.name+'<input type="hidden" id="lastViewedId" value='+c.id+"></a></li>"});$("#recentlyViewedTh").append(strLastViewed)})}function showHideTopic(a,c,b){pageStart=1;loadingImage();$.post("showHideTopic.htm",{userId:c,catId:a,action:b},function(e){if(e>0){multiSourceFilterFeeds(c,0,false)}})}function updateRecentlyViewed(a,b){$.post("updateRecentlyViewed.htm",{viewerId:a,id:b},function(c){if(c>0){selectlastViewedThreads(a)}})}function checkOnlineUsers(){$.post("getOnlineUsers",{},function(a){if(a.length!=undefined&&a.length>0){container=$("#onlineUsersContainer");displayUsers(a,container,1)}})}function getofflineUsers(){$.post("getOfflineUsers",{},function(a){container=$("#offlineUsersContainer");displayUsers(a,container,0)})}function displayUsers(c,b,e){addOfflineClass="";if(e==0){addOfflineClass="green offline"}var a="";b.empty();$.each(c,function(g,f){$("#myTask"+f.id).remove();userProfileImage=(f.profileimage==null)?"resources/images/blank.gif":profileImage+f.profileimage;jobTitle=f.jobTitle!=null?f.jobTitle:"";firstName=f.firstName!=null?f.firstName:"";lastName=f.lastName!=null?f.lastName:"";a+='<li><a id="myTask'+f.id+'" href="#" class="left-nav-user'+addOfflineClass+'"><img src="'+userProfileImage+'" width="32" height="32" title="'+f.email+'"><span><strong>'+firstName+" "+lastName+"</strong>"+jobTitle+" ("+f.regionName+")</span></a></li>"});b.append(a)}function checkUpdateStatus(g,f){var a=$("#filterCatId").val();var c=$("#filterUserId").val();var b=$("#hiddenUserId").val();var e=$("#filterStatusId").val();$.post("checkUpdates",{deleted:g,edited:f,feedSourceId:a,assignTo:c,loggedInUserId:b,status:e},function(j){if(j.length==undefined){j=""}if(j.length!=0||g==true||f==true){updateTaskMenu();var h=jQuery("[data-control=replyForm]"),i=h.parents("[data-control=replyWrapper]");if(i&&i.hasClass("show")){return}commonChecksAndDisplay(j,false)}})}function updateTaskMenu(a){$.post("updateTaskMenu",{userId:$("#hiddenUserId").val()},function(k){jQuery("[data-control=tasksMenuBtn]").empty();var l=k[0].split("-");var t=k[3].split("-");if(l[1]>0){jQuery("[data-control=tasksMenuBtn]").append('Tasks  <span class="past">'+t[1]+"</span>")}else{jQuery("[data-control=tasksMenuBtn]").append('Tasks  <span class="">'+t[1]+"</span>")}var g;var r;var q;var b;var p;var m;var o;var s;var c;var f;var n;var j;var h;var e;$.each(k,function(u,w){var v=w.split("-");if(v[0]=="displayOldTasksPending"){g=v[0];r=v[1];q="past";b="Past Due <span>"+v[1]+" tasks</span>"}if(v[0]=="displayTodaysDueTasks"){p=v[0];m="even";o="Due Today <span>"+v[1]+" tasks</span>"}if(v[0]=="displayUrgentTasks"){s=v[0];c="Urgent<span>"+v[1]+" tasks</span>"}if(v[0]=="displayTodaysTasksPending"){f=v[0];n=v[1];j="even";h="New <span>"+v[1]+" tasks</span>"}});var i=parseInt(r)+parseInt(n);str='<input type="hidden" id="pastDueTasks" value="false"><input type="hidden" id="dueTodayTasks" value="false"><input type="hidden" id="urgentTasks" value="false"><input type="hidden" id="todayPendingTasks" value="false"><input type="hidden" id="displayAllUsersTasks" value="false"><a id="'+g+'" href="'+g+'"'+q+'">'+b+'</a><a id="'+p+'" href="displayTodaysDueTasks" class="'+m+'">'+o+'</a><a id="'+s+'" href="'+s+'">'+c+'</a><a id="'+f+'" href="'+f+'" class="'+j+'">'+h+'</a><a id = "displayAllMyTasks" href="displayAllMyTasks">Total <span>'+i+" tasks</span></a>";jQuery("[class=module-table]").empty();jQuery("[class=module-table]").append(str)})}function updateRemaining(){$.post("updateRemaining",{feedSourceId:$("#feedSourceIdForFilter").val(),assignTo:$("#users").val()},function(a){$(".task-remain").text(a+" remaining tasks")})}function readRSSFeeds(){$.post("reedRssFeeds",function(a){})}function getFilelist(){var c=$("body").data("filelist");var e="";for(var b=0;b<c.length;b<b++){var a=(b==c.length-1)?"":",";e+=c[b].id+a}return e}function getFileNames(){var b=$("body").data("filelist");var e="";for(var c=0;c<b.length;c<c++){var a=(c==b.length-1)?"":",";e+=b[c].name+a}return e}function dialog(b,a){$("#msgbox").text(a);$("#msgbox").dialog({title:b,modal:true,buttons:{Ok:function(){$(this).dialog("close")}}})}function clearForm(){$("#feedSourceId").selectBox("value",null);$("#assignTo").selectBox("value",null);$("#name").val("");$("#summary").val("");$("#url").val("");$("#deadline").val("");$("#filename").empty();$("input[name=status]").attr("checked",false);$("#attachmentsCont").empty();$(".form-attached").remove();$("body").data("filelist",new Array());$("#assignEmailAndId").val("");$("#assignEmailAndId").attr("data-selected-item-id","")}function clearReplyForm(){$("#replyName").val("");$("#replySummary").val("");$("#replyUrl").val("");$("#replyStatus").selectBox("value",2);jQuery("[data-control=statusCurrent]").html("");jQuery("[data-control=statusCurrent]").append('<span class="status-item active"><i class="icon-on-it"></i> onit</span>');$("input[name=replyUrgentStatus]").attr("checked",false);$("#replyFilename").empty();$("#replyAttachmentsCont").empty();$(".form-attached").remove();$("body").data("filelist",new Array());$("#assignTask").val("");$("#assignTask").attr("data-selected-item-id","")}function clearUserForm(a){jQuery("[data-control=addUserForm]").removeClass("show").addClass("hide");jQuery("[data-control=addUserBtn]").removeClass("active");clearAnyForm(a);a.find("#regionId").selectBox("value",1);a.find("#roleId").selectBox("value",3)}function clearAnyForm(a){a.find("input:text, input:password, input:file, select, textarea").val("");a.find("input:radio, input:checkbox").removeAttr("checked").removeAttr("selected")}function displayList(n,o,l,m,j,k,f,a){var g="";var b=new Date();b.setHours(0,0,0,0);remainingDays="";var e="";d=new Date(n.createdAt);date=d.format("hh:MM TT");displayDate="Today";assignToUsername="All";if(n.assignToName!=null){assignToUsername=n.assignToName}if(n.deptName!=null){assignToUsername=n.deptName}if(l.toDateString()!=d.toDateString()){displayDate=d.format("dd mmm yyyy")}strEditDeleteEnable="";if(n.userId==$("#hiddenUserId").val()&&(l/1000-d/1000)<600&&n.feedType==0){strEditDeleteEnable="<div class='close-box'><a id = 'editFeed' href='#' data-control='editCampaign'></i><a id = 'deleteFeed' href='#' data-control='delCampaign'><i class='icon-close-box'></i><input type='hidden' id='deleteFeedId' value="+n.id+" name='deleteFeedId'/></a></div>"}if(n.deadline!=null&&n.deadline!=""){deadline=new Date(n.deadline);remainingDays=", Remaining days: <span>"+Math.round((deadline-b)/86400000)+"</span>"}var h=getStatusIcon(n);var i="";if(n.urgentStatus==true||n.status==1){i="<div class='urgent'></div>"}var c=j;strAttach="";if(k>0){$.each(c,function(r,q){strAttach+="<div><a href='"+attachmentsPath+q.attachmentId+q.fileExtension+"' class='btn-control attach' target='_blank' download = '"+q.name+"'><i class='icon-attach'></i><span>"+q.name+" </span></a></div>"})}firstName=n.firstName!=null?n.firstName:"";lastName=n.lastName!=null?n.lastName:"";if($("#listViewTypeSelected").val()==""){e="<div class='campaign-body'><div class='campaign-body-title'><span class='nick'>"+firstName+" "+lastName+"("+n.regionName+")</span>,<span class='date'> "+date+", "+displayDate+"</span></div><div class='campaign-body-txt' data-control='campaignShowMore'><input type='hidden' value="+n.id+" id='viewed' ><div class='campaign-body-trim'>"+n.summary+"</div><div class='show-more-wr'><a href='#' class='showMore'>show more</a></div></div></div>"}g+="<div id='taskContainer"+n.id+"' class='campaign-line "+m+"' data-control='campaignWrapper' data-taskId='"+n.id+"'><div style='background:"+n.colour+";' data-control='campaign' class='campaign-wrapper'><div class='campaign-container'><div id='title"+n.id+"' class='campaign-title-wr' data-control='campaignShowMore'><i class='"+h+"'></i><span class='campaign-title'>"+n.name+"</span><i class='icon-arrow-right'></i><div class='close-box'>"+strEditDeleteEnable+"</div>"+i+"</div><div class='campaign-content'>"+e+"<div class='campaign-info'>Assigned to: <span>"+assignToUsername+"</span>"+remainingDays+"<span class='float-right'>• <a id='"+((n.follower>0)?"unfollow":"follow")+"' href='#'>"+((n.follower>0)?"unfollow":"follow")+"<input type='hidden' id='followFeedId' value="+n.id+" name='followFeedId'/> </a> •<a href='#' data-control='campaignShowMore'>comments ("+o+")</a></span></div></div></div></div><div class='more-wrapper' data-control='campaignMore'><div class='more-container'><div class='more-title-wrapper'><div class='more-title'>"+n.name+"</div><div class='more-info'>by:<strong>"+firstName+" "+lastName+"</strong>,<span><span class='date'> "+date+", "+displayDate+"</span></span></div></div><div class='more-content'><pre>"+n.summary+"</pre></div>"+strAttach+"<div class='reply-wrapper hide' data-control='replyWrapper'></div><div class='comments-wrapper'><div class='comments-title-wr clearFix'><span class='comments-title'>COMMENTS ("+o+")</span><span class='float-right'><a id='"+n.id+"' href='#' class='write-comment' data-control='replyBtn'>add comment<input type='hidden' id='feedSourceIdForThis' value = "+n.feedSourceId+" name = 'feedSourceIdForThis'/><input type='hidden' id='assignTo' value= "+n.assignTo+" name='assignTo'/><input type='hidden' id='taskCreatorEmail' value='"+n.taskCreatorEmail+"' name='taskCreatorEmail'/><input type='hidden' id='postCommentEmailNotify' value= '"+n.taskUpdateEmailNotify+"' name='postCommentEmailNotify'/><input type='hidden' id='assignToName' value= '"+n.assignToName+"' name='assignToName'/><input type='hidden' id='assignerName' value='"+firstName+" "+lastName+"' name='assignerName'/><input type='hidden' id='taskTitle' value= '"+n.name+"' name='taskTitle'/> <input type='hidden' id='taskCreatorId' value="+n.userId+" name='taskCreatorId'/><input type='hidden' id='taskAssigneeEmail' value="+n.assignToEmail+" name='taskAssigneeEmail'/></a></span></div>";var p="";p=displaySubstasks(f,l,a);g+=p;return g+="<div class='comments-controls clearFix'><span class='float-right'>• <a id='follow' href='#'>follow<input type='hidden' id='followFeedId' value="+n.id+" name='followFeedId'/></a><input type='hidden' id='feedSourceIdForThis' value="+n.feedSourceId+" name='feedSourceIdForThis'/></a></span></div></div></div><div class='task-arrow'></div></div></div>"}function displaySubstasks(e,f,c){var a="",b="";if(c=="java"){a="<div id=comments"+e[0].id+">"}else{a="<div id=comments"+e.id+">"}$.each(e,function(h,g){if(h>0){dateCreated=new Date(g.createdAt);date=dateCreated.format("hh:MM TT");b=(g.profileImage==null)?"":g.profileImage;a+=displaySingleSubTask(g,f,dateCreated,g.summary,g.statusName,b,g.fileAttachment,g.attachmentCount)}});a+="</div>";return a}function displaySingleSubTask(a,c,j,i,b,e,g,k){var h="";displayDate="Today";pImage=(e=="")?"resources/images/blank.gif":profileImage+e;if(c.toDateString()!=j.toDateString()){displayDate=j.format("dd mmm yyyy hh:MM TT")}var f=g;strAttach="";if(k>0){$.each(f,function(m,l){strAttach+="<a href='"+attachmentsPath+l.id+l.fileExtension+"' class='btn-control attach' target='_blank' download = '"+l.name+"'><i class='icon-attach'></i><span>"+l.name+" </span></a>"})}h+="<div class='comment clearFix'><div class='comment-img'><img src='"+pImage+"' height='56'></div><div class='comment-txt'><div><pre>"+i+"</pre></div><div>"+strAttach+"</div><div class='comment-info clearFix'><span class='float-left comment-info-name'><strong>"+a.firstName+" "+a.lastName+"</strong> - "+((a.jobTitle==null)?"":a.jobTitle)+" ("+a.regionName+")<br>changed status to:"+b+"</span><span class='float-right comment-info-day'>"+displayDate+"</span></div></div></div>";return h}function getStatusIcon(b){var a="icon-rss";if(b.status==2){a="icon-on-it"}if(b.status==3){a="icon-pending"}if(b.status==4){a="icon-don"}return a};